# Automated Observability Stack

–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å—Ç–µ–∫–∞ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏ (Observability) –Ω–∞ –±–∞–∑–µ **Grafana, Loki, Tempo, Prometheus** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Vagrant** –∏ **Ansible**.

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Ö–æ–¥ **Infrastructure as Code (IaC)** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (HotROD), –≤–∫–ª—é—á–∞—è —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫, –ª–æ–≥–æ–≤ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–æ–∫ —Å –ø–æ–ª–Ω–æ–π –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4-—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø—Ä–∏–≤–∞—Ç–Ω–æ–π —Å–µ—Ç—å—é:

| –•–æ—Å—Ç | –†–æ–ª—å | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- | :--- |
| **mon01** | Monitoring Hub | Grafana, Loki, Tempo | –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —É–∑–µ–ª –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤/—Ç—Ä–µ–π—Å–æ–≤. |
| **prom01** | Time Series DB | Prometheus | –•—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ—Ç—Ä–∏–∫. –ù–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∏–µ–º –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ **Remote Write**. |
| **app01** | Application Node | Docker, Nginx, Alloy | –ó–∞–ø—É—Å–∫–∞–µ—Ç –¥–µ–º–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ HotROD. –ê–≥–µ–Ω—Ç **Grafana Alloy** —Å–æ–±–∏—Ä–∞–µ—Ç —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é. |
| **ansible01** | Control Node | Ansible, Python | –£–ø—Ä–∞–≤–ª—è—é—â–∏–π —É–∑–µ–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–ª–µ–π–±—É–∫–æ–≤. |

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ ACL
–í–º–µ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞ –∞–≥–µ–Ω—Ç–∞ —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤ –æ—Ç `root` –∏–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è AppArmor, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ —á–µ—Ä–µ–∑ **ACL (Access Control Lists)**.
*   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é `alloy` –≤—ã–¥–∞–Ω—ã –ø—Ä–∞–≤–∞ `rx` –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ Docker –∏ `r` –Ω–∞ —Ñ–∞–π–ª—ã JSON-–ª–æ–≥–æ–≤.
*   –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∫–æ–Ω—Ç—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

### 2. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ Ansible –†–æ–ª–∏
–†–æ–ª—å `startup_mon01` –Ω–∞–ø–∏—Å–∞–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **–≥–∏–±—Ä–∏–¥–Ω–æ–π –ª–æ–≥–∏–∫–∏**:
*   –ù–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö VM (Vagrant) –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Systemd** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞–º–∏.
*   –í —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ (Molecule/Docker) –æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ **—ç–º—É–ª—è—Ü–∏—é –ø—Ä–æ—Ü–µ—Å—Å–æ–≤** (background processes), —Ç–∞–∫ –∫–∞–∫ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç PID 1.

### 3. –ü–æ–ª–Ω–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å–≤—è–∑–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ Grafana —á–µ—Ä–µ–∑ Provisioning:
*   **Logs ‚Üí Traces:** –õ–æ–≥–∏ Loki –ø–∞—Ä—Å—è—Ç—Å—è –Ω–∞ –ª–µ—Ç—É, ID —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Å—Å—ã–ª–∫–∏ –Ω–∞ Tempo.
*   **Traces ‚Üí Logs:** –í Tempo –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ–∏—Å–∫ –ª–æ–≥–æ–≤ –ø–æ Trace ID —Å —É—á–µ—Ç–æ–º **Time Shift** (–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏).

### 4. –û–±—Ö–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Å—Ä–µ–¥—ã
–†–µ—à–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ **Windows/Hyper-V/VirtualBox**:
*   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø–∞—Ç—Ç–µ—Ä–Ω "Bastion Host" (ansible01) –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ Linux-–∫–æ–Ω—Ç—É—Ä–∞.
*   –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–æ–≤ SSH –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è **VirtualBox** –∏ **Vagrant**.

### –®–∞–≥ 1: –ü–æ–¥–Ω—è—Ç–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```bash
vagrant up
```
Vagrant —Å–æ–∑–¥–∞—Å—Ç 4 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç —Å–µ—Ç—å.

### –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —É–ø—Ä–∞–≤–ª—è—é—â–µ–º—É —É–∑–ª—É
```bash
vagrant ssh ansible01
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (Ansible)
–í–Ω—É—Ç—Ä–∏ –º–∞—à–∏–Ω—ã ansible01:
```bash
cd /vagrant/monitoring-ansible
ansible-playbook -i hosts.ini playbook.yml
```
## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–ª–µ–π–±—É–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ Grafana –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
URL: http://localhost:3000
Login: admin
Password: admin

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Molecule)
–†–æ–ª—å startup_mon01 –ø–æ–∫—Ä—ã—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏.
–í–Ω—É—Ç—Ä–∏ ansible01:
```bash
cd /vagrant/monitoring-ansible/roles/startup_mon01
molecule test
```

–¢–µ—Å—Ç—ã –ø–æ–¥–Ω–∏–º–∞—é—Ç Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç —Ä–æ–ª—å –∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å HTTP API —Å–µ—Ä–≤–∏—Å–æ–≤.
### –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
IaC: Ansible (Roles, Jinja2 Templates), Vagrant.
Monitoring: Grafana, Prometheus (Alerting Rules), Loki (LogQL), Tempo (TraceQL).
Agent: Grafana Alloy (OpenTelemetry Collector).
App: Jaeger HotROD (Go microservices).
Testing: Molecule, Docker.
